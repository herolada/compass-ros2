<?xml version="1.0" encoding="UTF-8"?>
<!-- SPDX-License-Identifier: BSD-3-Clause -->
<!-- SPDX-FileCopyrightText: Czech Technical University in Prague -->

<!-- Run magnetometer compass to provide azimuth. -->

<launch>
    <arg name="frame" default="base_link" description="The frame in which the azimuth should be computed." />
    <arg name="unbias" default="true" description="When true, magnetometer bias observer and remover will be launched." />
    <arg name="low_pass_ratio" default="0.2" description="Low pass smoothing ratio. 0 = raw measurements, 1 = no updates." />
    <arg name="visualize" default="true" description="Whether to publish a visualization of the azimuth" />
    <arg name="magnetic_declination" default="-0.068" description="Set magnetic declination to zero in simulation." />

    <include file="$(find-pkg-share magnetometer_pipeline)/launch/magnetometer_proc_launch_sim.xml" if="$(var unbias)">
    </include>

    <node pkg="magnetometer_compass" exec="magnetometer_compass_nodelet" name="compass" respawn="true">
        <param name="frame" value="$(var frame)" />
        <param name="low_pass_ratio" value="$(var low_pass_ratio)" />
        <param name="magnetic_declination" value="$(var magnetic_declination)" />
        <param name="subscribe_mag_unbiased" value="$(var unbias)" />
        <param name="publish_mag_azimuth_enu_rad" value="true" />
    </node>

    <node pkg="magnetometer_compass" exec="visualize_azimuth_nodelet" name="visualize_azimuth" if="$(var visualize)">
        <remap from="visualize_azimuth/azimuth" to="compass/mag/enu/rad" />
        <param name="magnetic_declination" value="$(var magnetic_declination)" />
        <param name="max_rate" value="10." />
        <param name="input_orientation" value="enu" />
        <param name="input_reference" value="magnetic" />
    </node>
</launch>